---
import Base from "../layouts/Base.astro";
import Nav from "../components/Nav.astro";
import Footer from "../components/Footer.astro";
import SectionShell from "../components/SectionShell.astro";
---

<Base title="Contact — The Wholeness Center" description="Book a walkthrough.">
  <Nav />
  <main class="pt-24">
    <SectionShell title="Contact" intro="We’ll respond within one business day.">
      <form
        id="contactForm"
        action="/api/contact"
        method="post"
        class="mt-8 rounded-2xl bg-white/85 p-6 text-juniper ring-1 ring-juniper/10 backdrop-blur md:p-8"
      >
        <label class="grid gap-1">
          <span class="text-xs uppercase tracking-wider">Name</span>
          <input
            required
            name="name"
            autocomplete="name"
            class="rounded-xl bg-white px-4 py-3 ring-1 ring-juniper/20 focus:outline-none focus:ring-2 focus:ring-sky"
          />
        </label>
        <label class="mt-4 grid gap-1">
          <span class="text-xs uppercase tracking-wider">Email</span>
          <input
            required
            type="email"
            name="email"
            autocomplete="email"
            class="rounded-xl bg-white px-4 py-3 ring-1 ring-juniper/20 focus:outline-none focus:ring-2 focus:ring-sky"
          />
        </label>
        <label class="mt-4 grid gap-1">
          <span class="text-xs uppercase tracking-wider">Message</span>
          <textarea
            required
            name="message"
            rows="5"
            class="rounded-xl bg-white px-4 py-3 ring-1 ring-juniper/20 focus:outline-none focus:ring-2 focus:ring-sky"
          ></textarea>
        </label>
        <input
          type="text"
          name="company"
          tabindex="-1"
          autocomplete="off"
          class="hidden"
          aria-hidden="true"
        />
        <div class="mt-6 flex flex-wrap items-center gap-3">
          <button class="rounded-pill bg-juniper px-5 py-3 text-sand hover:opacity-90" type="submit"
            >Send</button
          >
          <a class="text-juniper underline" href="mailto:intake@thewholenesscenter.org"
            >Or email directly</a
          >
        </div>
        <p id="formMsg" class="mt-3 text-sm text-juniper/80"></p>
      </form>
    </SectionShell>
  </main>
  <Footer />
</Base>

<script type="module">
  const form = document.getElementById("contactForm");
  const msg = document.getElementById("formMsg");
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    msg.textContent = "Sending…";
    try {
      const res = await fetch(form.action, { method: "POST", body: new FormData(form) });
      if (res.ok) {
        form.reset();
        msg.textContent = "Thanks — we’ll be in touch shortly.";
      } else if (res.status === 429) {
        msg.textContent = "Easy—one message a minute. Try again in a moment.";
      } else {
        msg.textContent = "Something went wrong. Please email us directly.";
      }
    } catch {
      msg.textContent = "Network issue. Please email us directly.";
    }
  });
</script>
